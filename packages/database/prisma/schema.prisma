// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id String @id @default(uuid())

  name          String?
  email         String   @unique
  emailVerified Boolean? @default(false)
  image         String?
  phone         String?
  isNewUser     Boolean  @default(true)
  role          String   @default("User")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  sessions Session[]
  accounts Account[]

  @@index([createdAt])
  @@index([name])
  @@index([phone])
}

model Session {
  id String @id @default(uuid())

  userId    String
  token     String   @unique
  expiresAt DateTime
  ipAddress String?
  userAgent String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Account {
  id String @id @default(uuid())

  userId     String
  accountId  String
  providerId String

  accessToken           String?   @db.Text
  refreshToken          String?   @db.Text
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  idToken               String?   @db.Text
  password              String?   @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([providerId, accountId])
  @@index([userId])
}

model Verification {
  id         String   @id @default(uuid())
  identifier String
  value      String   @unique
  expiresAt  DateTime

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([identifier, value])
}

model ClassName {
  id          String  @id @default(uuid())
  name        String  @unique
  description String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  students Student[]
}

model Institute {
  id      String @id @default(uuid())
  session String
  name    String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  students Student[]

  @@unique([session, name])
  @@index([session])
}

model Student {
  id          String   @id @default(uuid())
  session     String
  studentId   String
  name        String
  nameBangla  String
  fName       String
  mName       String
  gender      String
  dob         DateTime
  nationality String
  religion    String
  imageUrl    String?

  section String?
  shift   String
  group   String
  roll    String

  fPhone String
  mPhone String

  presentHouseNo    String
  presentMoholla    String
  presentPost       String
  presentThana      String
  permanentVillage  String
  permanentPost     String
  permanentThana    String
  permanentDistrict String

  instituteId String
  institute   Institute @relation(fields: [instituteId], references: [id], onDelete: Restrict)

  classNameId String
  className   ClassName @relation(fields: [classNameId], references: [id], onDelete: Restrict)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([instituteId])
  @@index([classNameId])
  @@index([session])
  @@index([studentId])
  @@index([name])
  @@index([roll])
}
